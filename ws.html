<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    </head>

    <body>
        <div class="msgs"></div>
        <button onclick="emitEvent()">test messages socket</button>
        <button onclick="redirect()">Test Conversation socket</button>
        <script>
            const socket = io('http://localhost:3003/messages', {
                withCredentials: true
            })
            const socketConversations = io('http://localhost:3003/conversations', {
                withCredentials: true
            })
            // console.log(socket)
            const messageBox = document.querySelector('.msgs')

            socket.on('whatsapp_message_received', function (data) {
                console.log(data)
                messageBox.innerHTML += `${data.Body}<hr>`
            })
            socketConversations.on('redirect_conversation', function (data) {
                console.log(data)
                messageBox.innerHTML += `${data.Body}<hr>`
            })
            socket.on('connect', function () {
                console.log('Connected to messages')

                //socket.emit('connected')
                // socket.emit('identity', 0, (response) => console.log('Identity:', response))
            })
            socket.on('events', function (data) {
                console.log('event', data)
            })

            socketConversations.on('connect', function () {
                console.log('Connected to Conversations')

                //socket.emit('connected')
                // socket.emit('identity', 0, (response) => console.log('Identity:', response))
            })

            function emitEvent() {
                socket.emit('test', { test: 'test' })
            }
            function redirect() {
                socketConversations.emit('redirect_conversation', { conversationId: 45, manager: 'user', managerId: 45 })
            }
            socket.on('exception', function (data) {
                console.log('event', data)
            })
            socket.on('disconnect', function () {
                console.log('Disconnected')
            })
        </script>
    </body>
</html>
